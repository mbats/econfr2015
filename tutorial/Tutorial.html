<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><h1 id="SiriusWorkshopAdvancedgraphicaleditorsforyourDSL">Sirius Workshop: Advanced graphical editors for your DSL</h1><h2 id="Overview">Overview</h2><p>This tutorial explains how to use advanced features of Sirius:</p><ul><li><a href="#Edge_Creation_Tool">Edge Creation Tool with preconditions</a></li><li><a href="#Reconnect_Edge_Tool">Reconnect Edge Tool</a></li><li><a href="#Delete_Element_Tool">Delete Element Tool</a></li><li><a href="#Direct_Edit_Label_Tool">Direct Edit Label Tool</a></li><li><a href="#SVG">SVG images</a></li><li><a href="#Style_Customization">Style Customization</a></li><li><a href="#Layers">Layers</a></li><li><a href="#Filters">Filters</a></li><li><a href="#Validation">Validation rules and Quick fixes</a></li><li><a href="#Container">Container with Sub Nodes and Bordered Nodes</a></li><li><a href="#Double_Click">Navigation through Double-click</a></li><li><a href="#Table">Table</a></li><li><a href="#Service">Java Services</a></li></ul><p>The instructions will guide you extending the basic modeling tool that is the result of the Sirius <a href="https://wiki.eclipse.org/Sirius/Tutorials/4MinTutorial">Starter Tutorial</a>. This starting modeling tool just allows you to create diagrams which represent Men and Women linked by parental relationships. From this diagram you can also use the palette to create Men. The advanced modeling workbench created with this new tutorial will complete the diagrams with many edition and visualization tools and new kinds of representations. </p><p>These instructions are based on the same simple Domain Model which describes basic concepts about families.</p><p>The modeling workbench created with this tutorial will allow users to visualize the members of a family and their parental relationships on a graphical diagram. It will also provide tools to edit the model from the diagram.</p><p><img border="0" src="https://wiki.eclipse.org/images/1/16/Sirius_4mtuto_01.png"/></p><p>Before starting the tutorial have a look to the <a href="https://github.com/mbats/econfr2015/blob/master/tutorial/Before.html">installation procedure</a>.</p><h2 id="Usinggittagtogoahead">Using git tag to go ahead</h2><h3 id="differences">View differences</h3><p>At any moment during the tutorial, to see the differences between your <em>working on</em> version and the expected one you can do a <code>git diff</code>. For example, when you are on the <code>initial_state</code> you can do:</p><ul><li>from the command line: <code>git diff creation</code></li></ul><p><img border="0" src="./images/sirius_tuto2_03-02.png"/></p><ul><li>from Obeo Designer with EGit and EMF Compare: Select the <em>basicfamily.odesign</em>, right click <em>Compare with &gt; Branch, Tag or Reference...</em> and select the tag:</li></ul><p><img border="0" src="./images/sirius_tuto2_03-03.png"/></p><p>The EMF Compare view opens showing the differences:<br/><img border="0" src="./images/sirius_tuto2_03-04.png"/></p><h3 id="tag">Go directly to a specified tag</h3><p>If you want to skip some steps, you can get directly the result of a step thanks to: <code>git reset --hard xxx</code>. For example, when you are on the <code>initial_state</code> you can go directly to the result of the <em>Creation</em> step:</p><ul><li>from the command line: <code>git reset --hard creation</code></li><li>from Obeo Designer with EGit: Select the project <code>org.eclipse.sirius.sample.basicfamily.design</code> from the Model Explorer and right click to select <em>Team &gt; Reset &gt; Tags</em>. Select a tag and in the reset type the <em><strong>Hard</strong></em> radio button: </li></ul><p><img border="0" src="./images/sirius_tuto2_03-05.png"/></p><p>If you have a look to the <em>odesign</em> file, it is updated with the expected changes.</p><h2 id="Startthetutorial">Start the tutorial</h2><h3 id="Creationtool">Creation tool</h3><p>The first step of this tutorial consists in completing the basic modeler with a tool to create <em>Women</em> also.</p><p>Copy and paste the tool <em>CreateMan</em>, then replace Man by <em>Woman</em>:</p><ul><li>in the <strong>Id</strong> of the tool</li><li>in the <strong>Node Mappings</strong> of the tool (use the wizard to select WomanNode)  </li><li>in the <strong>Create Instance</strong> operation (under the Begin section)</li><li>in the <strong>Value Expression</strong> of the Set <code>name</code> (under the Create instance)</li></ul><p><img border="0" src="./images/sirius_tuto2_03-01.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>creation</code></p><h3 id="Edge_Creation_Tool">Edge Creation Tool</h3><p>An <em>Edge Creation</em> tool allows the user to create relationships directly from the diagram, by using the palette.</p><p>Let&#8217;s use this tool to allow the user to set the father and the mother of a Person.</p><p>Right click on the <em>Section</em> and select the menu 'New Element Creation &gt; Edge Creation'</p><p><img border="0" src="./images/sirius_tuto2_04-01.png"/></p><p>Give an Id to this tool (setFather) and associate it to <em>fatherEdge</em>, the <em>Edge Mapping</em> which defines the father graphical relation.</p><p><img border="0" src="./images/sirius_tuto2_04-02.png"/></p><p>Then define the operations that will be performed by this tool each time the user will click on it. These operations can use four variables that are automatically set by Sirius:</p><ul><li><b>source</b>: the first object on which the user has clicked (the source of the relation he is going to create)</li><li><b>target</b>: the second object on which the user has clicked (the target of the relation he is going to create)</li><li><b>sourceView</b>: the graphical object representing the source</li><li><b>targetView</b>: the graphical object representing the target</li></ul><p>Under the <em>Begin</em> object, create a <em>Change Context</em> and set its <em>Browse Expression</em> to <code>var:source</code> in order to define the execution context of the next operations.</p><p><img border="0" src="./images/sirius_tuto2_04-03.png"/></p><p><img border="0" src="./images/sirius_tuto2_04-04.png"/></p><p>Under the <em>Change Context</em> create a <em>Set</em> which will set the <em>father</em> of the first Person clicked (source) to the second Person clicked (target):</p><ul><li>Feature Name: father</li><li>value Expression: var:target </li></ul><p><img border="0" src="./images/sirius_tuto2_04-05.png"/></p><p><img border="0" src="./images/sirius_tuto2_04-06.png"/></p><p>Save the <em>odesign</em> file and you will see a new tool <em>setFather</em> in the palette.</p><p><img border="0" src="./images/sirius_tuto2_04-07.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>edge_creation</code></p><h4 id="Precondition">Precondition</h4><p>To prevent the user to create a father relationship from a person to itself, or to one of its children, you can add a precondition expression (written in Acceleo 3).</p><p><img border="0" src="./images/sirius_tuto2_04-08.png"/></p><p>This expression uses to new variables:</p><ul><li><b>preSource</b>: the object on which the user has clicked first</li><li><b>preTarget</b>: the object under the cursor</li></ul><p>With this precondition, the tool will prevent the creation of forbidden links by showing a specific icon.</p><p><img border="0" src="./images/sirius_tuto2_04-09.png"/></p><p>Then copy, paste and update this tool to create the <em>setMother</em> tool.</p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>edge_creation_precondition</code></p><h3 id="Reconnect_Edge_Tool">Reconnect Edge Tool</h3><p>A <em>Reconnect Edge</em> tool allows the user to change the end of a relationship by moving it directly from the diagram.</p><p>Let&#8217;s create a <em>Reconnect Edge</em> tool to change the <em>father</em> and the <em>mother</em> of a Person.</p><p>Right click on the <em>Section</em> and select the menu New Element Edition &gt; Reconnect Edge</p><p><img border="0" src="./images/sirius_tuto2_05-01.png"/></p><p>Associate the <em>fatherEdge</em> to this reconnect tool.</p><p><img border="0" src="./images/sirius_tuto2_05-02.png"/></p><p>This tool comes with six variables:</p><ul><li><b>source</b>: the object currently attached to the moved end</li><li><b>target</b>: the object going to be attached to the moved end</li><li><b>sourceView</b>: the graphical object representing source</li><li><b>targetView</b>: the graphical object representing target</li><li><b>element</b>: the object attached to the other end</li><li><b>elementView</b>: the graphical object representing element</li></ul><p>Then create a <em>Change Context</em> and set its expression to <em>var:element</em> (the person who will change his father) </p><p>Finally, create a <em>Set</em> to assign the new selected parent (<em>var:target</em>) as <em>father</em> of this person.</p><p><img border="0" src="./images/sirius_tuto2_05-03.png"/></p><p>Copy, paste and update this tool to create a reconnect tool for <em>mother</em> relationship.</p><p>A Reconnect Edge tool allows the user to change the end of a relationship by moving it directly from the diagram.</p><p>Let&#8217;s create a reconnect edge tool to change the father and the mother of a person.</p><p>Right click on the Section and select the menu New Element Edition &gt; Reconnect Edge</p><p><img border="0" src="./images/sirius_tuto2_05-01.png"/></p><p>Associate the fatherEdge to this reconnect tool.</p><p><img border="0" src="./images/sirius_tuto2_05-02.png"/></p><p>This tool comes with six variables:</p><ul><li><b>source</b>: the object currently attached to the moved end</li><li><b>target</b>: the object going to be attached to the moved end</li><li><b>sourceView</b>: the graphical object representing source</li><li><b>targetView</b>: the graphical object representing target</li><li><b>element</b>: the object attached to the other end</li><li><b>elementView</b>: the graphical object representing element</li></ul><p>Then create a <em>Change Context</em> and set its expression to <em>var:element</em> (the person who will change his father) </p><p>Finally, create a <em>Set</em> to assign the new selected parent (<em>var:target</em>) as <em>father</em> of this person.</p><p><img border="0" src="./images/sirius_tuto2_05-03.png"/></p><p>Copy, paste and update this tool to create a reconnect tool for <em>mother</em> relationship.</p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>reconnect_edge</code></p><h3 id="Delete_Element_Tool">Delete Element Tool</h3><p>A <em>Delete Element</em> tool specifies which actions have to be performed when the user hits the delete key on an diagram element.</p><p>It is necessary on elements which deletion can&#8217;t be interpreted by Sirius (for example edges) or if you need to perform specific actions.</p><p>Let&#8217;s create a <em>Delete Element</em> tool to specify what to do when the user deletes a paretal relation.</p><p>Right click on the <em>Section</em> and select the menu 'New Element Edition &gt; Delete Element'</p><p><img border="0" src="./images/sirius_tuto2_06-01.png"/></p><p>Associate the <em>fatherEdge</em> to this Delete tool.</p><p><img border="0" src="./images/sirius_tuto2_06-02.png"/></p><p>When deleting an edge, the variable <b>element</b> refers to the source of the relationship.</p><p>So, create a <em>Change Context</em> and set its expression to <code>var:element</code> (the person which is the children). Then create a <em>Unset</em> on the feature <em>father</em> to remove this relation.</p><p><img border="0" src="./images/sirius_tuto2_06-03.png"/></p><p>Copy, paste and update this tool to create a delete tool for <em>mother</em> relationship.</p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>delete</code></p><h3 id="Direct_Edit_Label_Tool">Direct Edit Label Tool</h3><p>A <em>Direct Edit Label</em> specifies how to interpret the modification of graphical object&#8217;s label in order to modify the model. </p><p>Let&#8217;s create a <em>Direct Edit Label</em> to change the name of a Person directly from the diagram.</p><p>Right click on the <em>Section</em> and select the menu 'New Element Edition &gt; Direct Edit Label'</p><p><img border="0" src="./images/sirius_tuto2_07-01.png"/></p><p>Associate this tool to the objects which have a name: <em>ManNode</em> and <em>WomanNode</em></p><p><img border="0" src="./images/sirius_tuto2_07-02.png"/></p><p>This tool comes with a mask that creates variables depending on the label&#8217;s value. By default, the mask is set to <code>{0}</code>, which means that the variable named <em>0</em> will contain the full value of the label.  </p><p>Create a <em>Set</em> to indicate the feature of the edited object that will be modified (name) and the value to assign (var:0).</p><p><img border="0" src="./images/sirius_tuto2_07-03.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>direct_edit</code></p><h3 id="SVG">SVG</h3><p>Sirius supports SVG images to improve the quality of the diagrams.</p><p>Because the current designer uses PNG images, resizing a Man or Woman on a diagram causes the pixelation of images.</p><p><img border="0" src="./images/sirius_tuto2_08-01.png"/></p><p>There is <em>man.svg</em> and <em>woman.svg</em> in the <em>icons</em> folder.</p><p><img border="0" src="./images/sirius_tuto2_08-02.png"/></p><p>In the <em>Workspace Path</em> property of the <em>Workspace Images</em> associated to <em>ManNode</em> and <em>WomanNode</em>, replace the PNG images by these SVG images. </p><p><img border="0" src="./images/sirius_tuto2_08-03.png"/></p><p>Finally, set a predefined size to adapt the SVG image to the same size than the 32x32 PNG image (here enter <code>4</code>).</p><p><img border="0" src="./images/sirius_tuto2_08-04.png"/></p><p>Close and re-open the diagram to allow Sirius to take the modification into account: now the images are no more pixelated.</p><p><img border="0" src="./images/sirius_tuto2_08-05.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>svg</code></p><h3 id="Style_Customization">Style Customization</h3><p>Style Customizations change graphical properties of diagram elements (color, label, size, ...) depending on conditions.<br/>For example, let&#8217;s change the label of a Person depending on the number of its children:</p><ul><li>Person without children =&gt; color label in gray</li><li>Person having more than one children =&gt; set label size to 12</li><li>Person having grandchildren =&gt; prefix label with <em>Grandpa</em> or <em>Grandma</em></li></ul><p>Right click on the <em>Default Layer</em> and select the menu <em>New Customization &gt; Style Customizations</em>. It will group all the different customizations.</p><p><img border="0" src="./images/sirius_tuto2_09-01.png"/></p><p>Right click on the <em>Style Customizations</em> and select the menu <em>New Customization &gt; Style Customization</em> to create the first customization.</p><p><img border="0" src="./images/sirius_tuto2_09-02.png"/></p><p>Enter the Acceleo3 expression associated to this customization: <br/><code>[children-&gt;size()=0/]</code></p><p>Then define the graphical properties that will change if the condition is met.</p><p>Right click on the <em>Style Customization</em> and select the menu <em>New Customization</em>. To change the label color, create a <em>Property Customization (by selection)</em>. </p><p><img border="0" src="./images/sirius_tuto2_09-03.png"/></p><p>On this <em>Property Customization</em>, select the two Workspace Images for the <em>Applied On</em> field (they hold the label to change), enter <em>labelColor</em> in the Property Name field, then select the <em>gray</em> color.</p><p>Note that you can use the automatic-completion to select the applicable property.</p><p><img border="0" src="./images/sirius_tuto2_09-04.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>style_custo_select</code></p><p>Create a second <em>Style Customizations</em> with the condition:<br/><code>[children-&gt;size()&gt;1/]</code><br/>and add a <em>Style Customization (by expression)</em> to set the <em>labelSize</em> to <code>12</code>.</p><p><img border="0" src="./images/sirius_tuto2_09-05.png"/></p><p>Finally, create a third <em>Style Customizations</em> with the condition:<br/><code>[children.children-&gt;size()&gt;0/]</code></p><p>Add a <em>Style Customization (by expression)</em> for the <em>Workspace Image</em> corresponding to the Man, enter the property name <em>labelExpression</em> and the expression <code>['Grandpa '+name/]</code> (to prefix the person name with <em>Grandpa</em>).</p><p><img border="0" src="./images/sirius_tuto2_09-06.png"/></p><p>Do the same with the Woman image and the expression <code>['Grandma '+name/]</code>.</p><p>Save the <em>odesign</em> file and see the result on the diagram.</p><p><img border="0" src="./images/sirius_tuto2_09-07.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>style_custo_expr</code></p><h3 id="Layers">Layers</h3><p>With Sirius it is possible to allocate specific graphical elements to layers that can be activated/deactivated on demand by the user.</p><p>Let&#8217;s create two layers: one for the Men and one for the Women.</p><p>Right click on <em>Persons diagram</em> and select the menu <em>New Diagram Element &gt; Additional Layer</em>. </p><p><img border="0" src="./images/sirius_tuto2_10-03.png"/></p><p>Call this <em>Layer</em> <code>Men</code> and check the option <em>Active by default</em>.</p><p><img border="0" src="./images/sirius_tuto2_10-02.png"/></p><p>Create a <em>Section</em> in this layer then drag and drop all the elements related to the Man type into this layer.</p><p><img border="0" src="./images/sirius_tuto2_10-01.png"/></p><p>Create a second <em>Layer</em> <code>Women</code> and drag and drop all the elements related to the Woman type.</p><p>Re-open the sample diagram. You can see the two optional layers Men and Women (selected by default).</p><p><img border="0" src="./images/sirius_tuto2_10-04.png"/></p><p>If you de-activate the <em>Men</em> layer, only women remain on the diagram. Note that the tools related to men have been hidden too.</p><p><img border="0" src="./images/sirius_tuto2_10-05.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>layer</code></p><h3 id="Filters">Filters</h3><p>With <em>Filters</em>, Sirius provides an additional mechanism to automatically show or hide elements of a diagram: a condition determines which elements remain visible.</p><p>Let&#8217;s create a <em>Filter</em> to hide Persons without children.</p><p>Right click on <em>Persons diagram</em> and select the menu <em>New Filter &gt; Composite Filter</em>. </p><p><img border="0" src="./images/sirius_tuto2_11-01.png"/></p><p>Set the <em>id</em> to <code>childrenFilter</code>.</p><p>Then create a <em>Mapping Filter</em>.</p><p><img border="0" src="./images/sirius_tuto2_11-02.png"/></p><p>Associate <em>ManNode</em> and <em>WomanNode</em> to this filter and define the <em>Semantic Condition Expression</em> : <code>[children-&gt;size()&gt;0/]</code></p><p><img border="0" src="./images/sirius_tuto2_11-03.png"/></p><p>On the diagram, you can now select the filter <em>childrenFilter</em> and see that only persons with children remain visible.</p><p><img border="0" src="./images/sirius_tuto2_11-04.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>filter</code></p><h3 id="Validation">Validation Rules and Quick Fixes</h3><p>Validation rules allow the user to evaluate the quality of a model.</p><p>For example, despite the precondition we have created on the edge creation tool, users can still create circular parental relations between two persons by using the Properties View.</p><p>Let&#8217;s create a <em>Validation Rule</em> to detect this problem.</p><p>Right click on <em>Persons diagram</em> and select the menu <em>New Validation &gt; Validation</em>. </p><p><img border="0" src="./images/sirius_tuto2_12-01.png"/></p><p>Set the name &#8249;FamilyValidation&#8250; to this <em>Validation</em>. Then create a <em>Semantic Validation Rule</em>.</p><p><img border="0" src="./images/sirius_tuto2_12-02.png"/></p><p>Set the properties of this rule:</p><ul><li><strong>Level</strong>: <code>Error</code></li><li><strong>Target Class</strong>: <code>basicfamily.Person</code></li><li><strong>Message</strong>: <code>['Children of '+name+' should not include his father ('+father.name+')'/]</code></li></ul><p><img border="0" src="./images/sirius_tuto2_12-03.png"/></p><p>Then create an <em>Audit</em> (a condition corresponding to this rule) with the expression <code>[not children-&gt;includes(father)/]</code>.</p><p><img border="0" src="./images/sirius_tuto2_12-04.png"/></p><p>To test this rule, introduce an error in the model with the <em>Property View</em>: set the father of a Man to its son.</p><p><img border="0" src="./images/sirius_tuto2_12-05.png"/></p><p>Then right-click on the diagram and select the menu <em>Validate diagram</em>.</p><p><img border="0" src="./images/sirius_tuto2_12-06.png"/></p><p>The circular father relationship is detected and a decorator (corresponding to the rule level) is displayed on the persons with this problem. A tootip contains the error message.</p><p><img border="0" src="./images/sirius_tuto2_12-07.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>validation</code></p><h4 id="Fix">Fix</h4><p><em>Fixes</em> can be provided to the user for solving the problem automatically. </p><p>For example, we can propose to unset one of the two <em>father</em> relations.</p><p>Right-click on the <em>Rule</em> and select the menu &#8249;New &gt; Fix&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_13-01.png"/></p><p>Set the <em>name</em> <code>Unset father</code> to this <em>Fix</em> and create a <em>Begin</em>. Then create a <em>Unset</em> and enter <code>father</code> in the <em>Feature name</em>.</p><p><img border="0" src="./images/sirius_tuto2_13-02.png"/></p><p>If you open the <em>Problems View</em>, you can right-click on one of the errors and select the menu <em>Quick Fix</em>.</p><p><img border="0" src="./images/sirius_tuto2_13-03.png"/></p><p>A dialog opens which proposes the available fixes.</p><p><img border="0" src="./images/sirius_tuto2_13-04.png"/></p><p>Select <em>Unset father</em> and click on <em>Finish</em>: the father of the selected person is automatically unset and the problem is solved.</p><p><img border="0" src="./images/sirius_tuto2_13-05.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>validation_fix</code></p><h3 id="ObjectCenteredDiagram">Object-Centered Diagram</h3><p>The <em>Persons diagram</em> is a representation related to the whole model: it displays all the members of the family. This is the reason why it belongs to the Family instance, as you can see in the Model Explorer.</p><p><img border="0" src="./images/sirius_tuto2_14-01.png"/></p><p>With Sirius, you can create a representation on any instance of the model. For example, let&#8217;s create a person-centered diagram to show only the relationships of a given person.</p><p>Right-click on the <em>persons</em> viewpoint and select the menu &#8249;New Representation &gt; Diagram Description&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_14-02.png"/></p><p>Set these properties to this representation:</p><ul><li><b>Name</b>: <code>Relationships diagram</code></li><li><b>Domain Class</b>: <code>basicfamily.Person</code></li></ul><p><img border="0" src="./images/sirius_tuto2_14-03.png"/></p><p>In the <em>Advanced</em> tab, set the <b>Title Expression</b> to <code>['Relations of '+name/]</code> in order to customize the name of the diagram with the person&#8217;s name.</p><p><img border="0" src="./images/sirius_tuto2_14-04.png"/></p><p>Add a <em>Default Layer</em> to this diagram and save the <em>odesign</em> file. Now, you can right click on a person in the <em>Model Explorer</em> and create a new representation of type <em>Relationships diagram</em>.</p><p><img border="0" src="./images/sirius_tuto2_14-05.png"/></p><p>The result is a blank diagram, since we have not yet specified its content.</p><h4 id="Container">Container</h4><p>A <em>Container</em> is a kind of diagram element that can contain other diagram elements.</p><p>On the <em>Relationships diagram</em>, let&#8217;s use two containers to represent:</p><ul><li>The current person (who owns the diagram) with:<ul><li>each children in a list</li><li>its parents as border nodes</li></ul></li><li>The siblings of the current person:<ul><li>each sibling in a list</li></ul></li></ul><p>Right-click on the <em>Layer</em> and select the menu &#8249;New Diagram Element &gt; Container&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_15-01.png"/></p><p>For this first container, set these properties:</p><ul><li><strong>Name</strong>: <code>Person Container</code></li><li><strong>Domain Class</strong>: <code>basicfamily.Person</code></li><li><strong>Semantic Candidate Expression</strong>: <code>var:self</code> (the current person)</li><li><strong>Children Presentation</strong>: <code>List</code></li></ul><p><img border="0" src="./images/sirius_tuto2_15-02.png"/></p><p>To define the graphical rendering of this container, right-click on it and select the menu &#8249;New Style &gt; Gradient&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_15-03.png"/></p><p>On this style, set these properties:</p><ul><li>Label Tab:<ul><li><strong>Label Size</strong>: <code>12</code></li><li><strong>Label Format</strong>: <code>bold</code></li></ul></li></ul><p><img border="0" src="./images/sirius_tuto2_15-04.png"/></p><ul><li>Color Tab:<ul><li><strong>Foreground Color</strong>: <code>light_green</code></li></ul></li></ul><p><img border="0" src="./images/sirius_tuto2_15-05.png"/></p><p>Save the <em>odesign</em> file and you see a green container appear on the diagram that you have created for a person.</p><p><img border="0" src="./images/sirius_tuto2_15-06.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>container</code></p><h4 id="SubNodes">Sub Nodes</h4><p>Now, to display children inside this container, right-click on the container definition and click on the menu &#8249;New Diagram Element &gt; Sub Node&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_16-01.png"/></p><p>On the <em>Sub Node</em> set these properties:</p><ul><li><strong>Id</strong>: <code>ChildrenNode</code></li><li><strong>Domain Class</strong>: <code>basicfamily.Person</code></li><li><strong>Semantic Candidate Expression</strong>: <code>feature:children</code></li></ul><p><img border="0" src="./images/sirius_tuto2_16-02.png"/></p><p>Then create a style. Note that the kind of style is not important here: for elements in a list, the style is used only to specify the label.</p><p><img border="0" src="./images/sirius_tuto2_16-03.png"/></p><p>Save the <em>odesign</em> file, and now you can see the children listed inside the container.</p><p><img border="0" src="./images/sirius_tuto2_16-04.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>sub_node</code></p><p>Copy paste <em>PersonContainer</em> to create the container for siblings.</p><p>Change these properties on this new container description:</p><ul><li>Container &gt; <strong>Name</strong>: <code>SiblingsContainer</code></li><li>Gradient &gt; <strong>Label Size</strong>: <code>10</code></li><li>Gradient &gt; <strong>Label Expression</strong>: <code>Siblings</code></li><li>Gradient &gt; <strong>Foreground Color</strong>: <code>light_yellow</code></li></ul><p>And these properties on the <em>Sub Node</em>:</p><ul><li><strong>Id</strong>: <code>Sibling Node</code></li><li><strong>Semantic Candidates Expression</strong>: <code>[parents.children-&gt;excluding(self)/]</code></li></ul><p><img border="0" src="./images/sirius_tuto2_16-05.png"/></p><p>Save the <em>odesign</em> file, and now you can see the siblings listed inside a second container.</p><p><img border="0" src="./images/sirius_tuto2_16-06.png"/></p><h4 id="BorderNode">Border Node</h4><p>Now let&#8217;s add <em>Border Nodes</em> to the first container to display the parents of the current person.</p><p>Right-click on <em>PersonContainer</em> and select the menu &#8249;New Diagram Element &gt; Border Node&#8250;:</p><p><img border="0" src="./images/sirius_tuto2_17-01.png"/></p><p>Set these properties to the border node:</p><ul><li><strong>Id</strong>: <code>ParentNode</code></li><li><strong>Domain Class</strong>: <code>basicfamily.Person</code></li><li><strong>Semantic Candidate Expression</strong>: <code>feature:parents</code></li></ul><p><img border="0" src="./images/sirius_tuto2_17-02.png"/></p><p>Add a <em>Square</em> as style, and set these properties:</p><ul><li><strong>Label Position</strong>: <code>Node</code></li><li><strong>Color</strong>: <code>white</code></li></ul><p>Save the <em>odesign</em> file, and now you can see the parents attached on the border of the first container:</p><p><img border="0" src="./images/sirius_tuto2_17-03.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>border_node</code></p><h4 id="Edgebetweencontainers">Edge between containers</h4><p>Like nodes, <em>Containers</em> can be linked with <em>Edges</em>.</p><p>Right-click on the <em>Default</em> container and select the menu &#8249;New Diagram Element &gt; Relation Based Edge&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_18-01.png"/></p><p>Set these properties to the edge:</p><ul><li><strong>Id</strong>: <code>SiblingsEdge</code></li><li><strong>Source Mapping</strong>: <code>PersonContainer</code></li><li><strong>Target Mapping</strong>: <code>SiblingsContainer</code></li><li><strong>Target Finder Expression</strong>: <code>var:self</code> (the second container represents the current person also)</li></ul><p><img border="0" src="./images/sirius_tuto2_18-02.png"/></p><p>On the style of the edge (automatically created), you can specify the end&#8217;s decorators.</p><p><img border="0" src="./images/sirius_tuto2_18-03.png"/></p><p>Save the <em>odesign</em> file, and now you can see a link between the two containers.</p><p><img border="0" src="./images/sirius_tuto2_18-04.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>container_edge</code></p><h3 id="Double_Click">Double-click</h3><p>Now we can create a specific diagram for each person. To facilitate the navigation between all these diagrams, let&#8217;s create a <em>Double Click</em> tool that allows the user to navigate from any person on a diagram to its dedicated diagram.</p><p>Go back to the first diagram, right click on the <em>Section</em> in the first <em>Layer</em> and select the menu &#8249;New Element Edition &gt; Double Click&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_19-01.png"/></p><p>On the <strong>Mappings</strong> property of the <em>Double Click</em> select all the elements of the modeling tool that represent a <em>Person</em> (except the two containers, since it doesn&#8217;t make sense to navigate to the current diagram).</p><p><img border="0" src="./images/sirius_tuto2_19-02.png"/></p><p>To specify the action of the <em>Double Click</em>, right-click on the <em>Begin</em> and select the menu &#8249;New Operation &gt; Navigation&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_19-03.png"/></p><p>Then set these properties to the <em>Navigation</em> :</p><ul><li><strong>Diagram Description</strong>: <code>Relationships diagram</code></li><li><strong>Creae if not Existent</strong>: <code>true</code></li></ul><p><img border="0" src="./images/sirius_tuto2_19-04.png"/></p><p>Save the <em>odesign</em> file, close and reopen your diagrams. Now you can double-click on persons to open their corresponding <em>Relationships diagram</em>. If this diagram has not been created yet, Sirius will propose to create it.</p><p><img border="0" src="./images/sirius_tuto2_19-05.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>double_click</code></p><h3 id="Table">Table</h3><p>With Sirius it is also possible to represent model elements with a <em>Table</em>.</p><p>Let&#8217;s create a table that lists all the persons, with this information for each:</p><ul><li>father&#8217;s name</li><li>mother&#8217;s name</li><li>number of children</li></ul><p>Right-click on the <em>Viewpoint</em> and select the menu <code>New representation &gt; Edition Table Description</code>.</p><p><img border="0" src="./images/sirius_tuto2_20-01.png"/></p><p>Set these properties to the table:</p><ul><li><em>Id</em>: <code>Persons table</code></li><li><em>Domain Class</em>: <code>basicfamily.Family</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-02.png"/></p><p>In this table, you need lines to represent the persons. So, right-click on the <em>Table</em> and select the menu &#8249;New Table Element &gt; Line&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_20-03.png"/></p><p>Set these properties to the line:</p><ul><li><em>Id</em>: <code>PersonLine</code></li><li><em>Domain Class</em>: <code>basicfamily.Person</code></li><li><em>Header Label Expression</em> (tab <em>Label</em>): <code>feature:name</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-04.png"/></p><p>Save the <em>odesign</em> file then right-click on the <em>Family</em> instance in the <em>Model Rrowser</em> and click on the menu 'New Representation. You can see a new menu &#8249;new Persons table&#8250;. </p><p><img border="0" src="./images/sirius_tuto2_20-05.png"/></p><p>If you select this menu, Sirius creates and opens a table with all the family&#8217;s members.</p><p><img border="0" src="./images/sirius_tuto2_20-06.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>table</code></p><p>Now, let&#8217;s add columns to this table to display more information for each person. So, right-click on the <em>Table</em> and select the menu &#8249;New Table Element &gt; Feature Column&#8250;.</p><p><img border="0" src="./images/sirius_tuto2_20-07.png"/></p><p>Set these properties to the column:</p><ul><li><em>Id</em>: <code>fatherCol</code></li><li><em>Feature Name</em>: <code>father</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-08.png"/></p><p>Select the <em>Label</em> tab and set these properties:</p><ul><li><em>Header Label Expression</em>: <code>Father</code></li><li><em>label Expression</em>: <code>[if father.oclIsUndefined() then '' else father.name endif/]</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-09.png"/></p><p>Copy and paste &#8249;fatherCol&#8250; then rename <code>father</code> by <code>mother</code> in all the properties.</p><p><img border="0" src="./images/sirius_tuto2_20-10.png"/></p><p>Save the <em>odesign</em> file and see the two new columns.</p><p><img border="0" src="./images/sirius_tuto2_20-11.png"/></p><p>Finally, add a new <em>Feature Column</em> to display the number of children.</p><p>Set these properties to the column:</p><ul><li><em>Id</em>: <code>childrenCol</code></li><li><em>Feature Name</em>: <code>children</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-12.png"/></p><p>Select the <em>Label</em> tab and set these properties:</p><ul><li><em>Header Label Expression</em>: <code>Children</code></li><li><em>label Expression</em>: <code>[children-&gt;size()/]</code></li></ul><p><img border="0" src="./images/sirius_tuto2_20-13.png"/></p><p>Save the <em>odesign</em> file and see the third column.</p><p><img border="0" src="./images/sirius_tuto2_20-14.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>table_col</code></p><h3 id="Service">Java Services</h3><p>When <em>Acceleo 3</em> expressions become complex, you should write <em>Java Services</em> instead.</p><p>For example, let&#8217;s create a <em>Java Service</em> to compute the number of cousins and display this information in the table.</p><p>Open the <em>Java Class</em> named <code>FamilyServices</code> in your <em>Viewpoint Specification Project</em> (which contains the <em>odesign</em> file). Have a look to the method named <code>getCousinsNumber</code>.</p><p><img border="0" src="./images/sirius_tuto2_21-01.png"/></p><p>You can use the code below to complete this class:</p><p><pre><br/>package org.eclipse.sirius.sample.basicfamily.design;</p><p>import java.util.ArrayList;<br/>import java.util.List;</p><p>import org.eclipse.sirius.sample.basicfamily.Person;</p><p>public class FamilyServices {</p><p>	public int getCousinsNumber(Person person) {<br/>		List&lt;Person&gt; cousins=new ArrayList&lt;Person&gt;();<br/>		List&lt;Person&gt; parents=person.getParents();</p><p>		for (Person parent: parents) {<br/>			for (Person grandParent: parent.getParents()) {<br/>				for (Person uncleOrAunt: grandParent.getChildren()) {<br/>					if (!parents.contains(uncleOrAunt)) {<br/>						for (Person cousin:uncleOrAunt.getChildren()) {<br/>							if (!cousins.contains(cousin))<br/>								cousins.add(cousin);<br/>						}<br/>					}<br/>				}<br/>			}<br/>		}<br/>		return cousins.size();	<br/>	}<br/>}<br/></pre></p><p>To be able to use the Java methods as <em>Services</em>, the class must be declared in the <em>odesign</em> file.</p><p>Right-click on the <em>Viewpoint</em> then select the menu <code>New Extension &gt; Java Extension</code>.</p><p><img border="0" src="./images/sirius_tuto2_21-02.png"/></p><p>Then, set the <em>Qualified Class Name</em> property to <code>org.eclipse.sirius.sample.basicfamily.services.FamilyServices</code>.</p><p>To use the service <em>getCousinsNumber</em> in the table, create a new <em>Feature Column</em> named <code>cousinsCol</code> and invoke the service in the expression (<code>service:getCousinsNumber</code>).</p><p><img border="0" src="./images/sirius_tuto2_21-04.png"/></p><p>With Sirius 2.0, Java services can&#8217;t be tested from the same runtime: you need to launch a <b>new runtime</b>.</p><p>Create and launch a new <em>Run Configuration</em> of type <em>Eclipse Application</em> and set the arguments <code>-XX:MaxPermSize=256m</code>.</p><p><img border="0" src="./images/sirius_tuto2_21-05.png"/></p><p>In the new runtime, import the <em>basicfamily.sample</em> project and create a diagram and a table on Family.</p><p>In this table, you can see a new column <em>Cousins</em> containing the number of cousins for each person (0). Use the diagram to create more persons such as some of them have cousins: Sirius will automatically update the number of cousins in the table.</p><p><img border="0" src="./images/sirius_tuto2_21-06.png"/></p><p>To see the <a href="#differences">result</a>, have a look on the <a href="#tag">tag</a> : <code>java_service</code></p></body></html>